<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Judge</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- CodeMirror Editor Libraries (UMD builds) -->
    <script src="https://unpkg.com/@codemirror/state@6.4.1/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/view@6.26.3/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/commands@6.5.0/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/language@6.10.1/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@lezer/javascript@1.4.8/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/lang-javascript@6.2.2/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@lezer/python@1.1.8/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/lang-python@6.1.6/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@lezer/java@1.0.3/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/lang-java@6.0.1/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@lezer/cpp@1.1.3/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/lang-cpp@6.0.2/dist/index.umd.js"></script>
    <script src="https://unpkg.com/@codemirror/theme-one-dark@6.1.2/dist/index.umd.js"></script>
    
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
    <style>
        .cm-editor { height: 100%; }
    </style>
</head>
<body class="bg-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- Configuration ---
        const API_BASE_URL = "http://127.0.0.1:5000";
        
        // --- Firebase Configuration ---
        // IMPORTANT: Replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // --- React Hooks and Components ---
        const { useState, useEffect, useRef } = React;

        // --- Mock Data ---
        const mockProblems = [
            {
                id: 1,
                title: "Two Sum",
                difficulty: "Easy",
                description: `<p class="mb-4">Given an array of integers <code>nums</code> and an integer <code>target</code>, return indices of the two numbers such that they add up to <code>target</code>.</p><p>You may assume that each input would have <strong>exactly one solution</strong>, and you may not use the <em>same</em> element twice.</p><p>You can return the answer in any order.</p>`,
                examples: [
                    { input: 'nums = [2,7,11,15], target = 9', output: '[0,1]', explanation: 'Because nums[0] + nums[1] == 9, we return [0, 1].' },
                    { input: 'nums = [3,2,4], target = 6', output: '[1,2]' },
                    { input: 'nums = [3,3], target = 6', output: '[0,1]' },
                ],
                constraints: [
                    '<code>2 <= nums.length <= 10<sup>4</sup></code>',
                    '<code>-10<sup>9</sup> <= nums[i] <= 10<sup>9</sup></code>',
                    '<code>-10<sup>9</sup> <= target <= 10<sup>9</sup></code>',
                    '<strong>Only one valid answer exists.</strong>'
                ],
                hints: [
                    'A really brute-force way would be to search for all possible pairs of numbers but that would be too slow. Or is it? Try to optimize it.',
                    'Can you do it in one pass? If you iterate through the array, what information do you need to store to find the complement of the current number?'
                ],
                boilerplate: {
                    python: `class Solution:\n    def twoSum(self, nums: list[int], target: int) -> list[int]:\n        # Your code here\n        pass`,
                    javascript: `/**\n * @param {number[]} nums\n * @param {number} target\n * @return {number[]}\n */\nvar twoSum = function(nums, target) {\n    \n};`,
                    java: `class Solution {\n    public int[] twoSum(int[] nums, int target) {\n        \n    }\n}`,
                    cpp: `class Solution {\npublic:\n    vector<int> twoSum(vector<int>& nums, int target) {\n        \n    }\n};`
                }
            },
            // ... other problems
        ].concat([...Array(49)].map((_, i) => ({ id: 1000 + i, title: `Placeholder Problem ${i + 1}`, difficulty: ["Easy", "Medium", "Hard"][i % 3], description: `<p>This is a placeholder description for problem ${i + 1}.</p>`, examples: [], constraints: [], hints: [], boilerplate: { python: `# Placeholder for problem ${i + 1}`, javascript: `// Placeholder for problem ${i + 1}`, java: `// Placeholder for problem ${i + 1}`, cpp: `// Placeholder for problem ${i + 1}` } })));
        
        const CodeEditor = ({ language, boilerplate, onCodeChange }) => {
            const editorRef = useRef(null);
            const viewRef = useRef(null);
            const [isEditorReady, setIsEditorReady] = useState(false);

            useEffect(() => {
                const checkLibs = () => {
                    if (window.state && window.view && window.commands) {
                        setIsEditorReady(true);
                    } else {
                        setTimeout(checkLibs, 100);
                    }
                };
                checkLibs();
            }, []);

            useEffect(() => {
                if (!isEditorReady || !editorRef.current) return;

                const { EditorState } = window.state;
                const { EditorView, keymap } = window.view;
                const { defaultKeymap } = window.commands;
                const { oneDark } = window.themeOneDark;
                const languageExtensions = {
                    python: window.langPython.python(),
                    javascript: window.langJavascript.javascript(),
                    java: window.langJava.java(),
                    cpp: window.langCpp.cpp(),
                };

                const onUpdate = EditorView.updateListener.of(update => {
                    if (update.docChanged) {
                        onCodeChange(update.state.doc.toString());
                    }
                });
                
                if (viewRef.current) {
                    viewRef.current.destroy();
                }

                const startState = EditorState.create({
                    doc: boilerplate,
                    extensions: [
                        keymap.of(defaultKeymap),
                        languageExtensions[language],
                        oneDark,
                        EditorView.lineWrapping,
                        onUpdate
                    ],
                });
                viewRef.current = new EditorView({ state: startState, parent: editorRef.current });

            }, [isEditorReady, language, boilerplate]);

            if (!isEditorReady) {
                return <div className="h-full w-full bg-[#2d2d2d] flex items-center justify-center text-white/50">Loading Editor...</div>;
            }

            return <div ref={editorRef} className="h-full w-full bg-[#2d2d2d]"></div>;
        };

        const ProblemDescription = ({ problem }) => {
             if (!problem) return null;
            const difficultyColor = { 'Easy': 'text-green-500', 'Medium': 'text-yellow-500', 'Hard': 'text-red-500' };
            return (
                <div className="p-6 h-full overflow-y-auto text-gray-300">
                    <h1 className="text-xl font-medium text-gray-100 mb-4">{problem.id}. {problem.title}</h1>
                    <p className={`font-medium text-sm ${difficultyColor[problem.difficulty]}`}>{problem.difficulty}</p>
                    <hr className="my-4 border-gray-600" />
                    
                    <div className="prose prose-invert max-w-none text-gray-300" dangerouslySetInnerHTML={{ __html: problem.description }} />
                    
                    {problem.examples && problem.examples.length > 0 && (
                        <div className="mt-6 space-y-4">
                            {problem.examples.map((ex, index) => (
                                <div key={index}>
                                    <p className="font-medium text-gray-300">Example {index + 1}:</p>
                                    <pre className="bg-gray-900/50 p-3 rounded-md text-sm mt-2 whitespace-pre-wrap">
                                        <strong className="text-gray-400">Input:</strong> {ex.input}<br />
                                        <strong className="text-gray-400">Output:</strong> {ex.output}
                                        {ex.explanation && <><br /><strong className="text-gray-400">Explanation:</strong> {ex.explanation}</>}
                                    </pre>
                                </div>
                            ))}
                        </div>
                    )}

                    {problem.constraints && problem.constraints.length > 0 && (
                        <div className="mt-6">
                            <h3 className="font-semibold mb-2 text-gray-200">Constraints:</h3>
                            <ul className="list-disc list-inside space-y-1 text-sm text-gray-400">
                                {problem.constraints.map((c, index) => <li key={index} dangerouslySetInnerHTML={{ __html: c }} />)}
                            </ul>
                        </div>
                    )}

                     {problem.hints && problem.hints.length > 0 && (
                         <div className="mt-6">
                            <h3 className="font-semibold mb-2 text-gray-200">Hints:</h3>
                             <ul className="list-disc list-inside space-y-1 text-sm text-gray-400">
                                {problem.hints.map((h, index) => <li key={index}>{h}</li>)}
                            </ul>
                        </div>
                    )}
                </div>
            );
        };
        
        const ProblemListModal = ({ problems, onSelectProblem, onClose }) => {
            const difficultyColor = { 'Easy': 'text-green-400', 'Medium': 'text-yellow-400', 'Hard': 'text-red-400' };
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
                    <div className="bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl h-full max-h-[90vh] flex flex-col">
                        <div className="flex justify-between items-center p-4 border-b border-gray-700">
                            <h2 className="text-xl font-bold text-white">Problems</h2>
                            <button onClick={onClose} className="text-gray-400 hover:text-white text-2xl font-bold">&times;</button>
                        </div>
                        <div className="overflow-y-auto">
                            <table className="w-full text-sm text-left text-gray-400">
                                <thead className="text-xs text-gray-400 uppercase bg-gray-700/50 sticky top-0">
                                    <tr>
                                        <th scope="col" className="px-6 py-3">Title</th>
                                        <th scope="col" className="px-6 py-3">Difficulty</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {problems.map(p => (
                                        <tr key={p.id} onClick={() => onSelectProblem(p)} className="bg-gray-800 border-b border-gray-700 hover:bg-gray-700 cursor-pointer">
                                            <td className="px-6 py-4 font-medium text-gray-200 whitespace-nowrap">{p.id}. {p.title}</td>
                                            <td className={`px-6 py-4 ${difficultyColor[p.difficulty]}`}>{p.difficulty}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const ResultPanel = ({ result }) => {
            const [activeTab, setActiveTab] = useState('testcase');

            const getStatusPill = (status) => {
                switch (status) {
                    case 'PENDING':
                    case 'Running':
                        return <span className="px-3 py-1 text-sm font-semibold rounded-full bg-yellow-400 text-yellow-900 animate-pulse">{status}...</span>;
                    case 'Accepted':
                        return <span className="px-3 py-1 text-sm font-semibold rounded-full bg-green-400 text-green-900">Accepted</span>;
                    default:
                        return <span className="px-3 py-1 text-sm font-semibold rounded-full bg-red-400 text-red-900">{status}</span>;
                }
            };
            
            return (
                <div className="bg-gray-800 text-gray-300 rounded-b-lg">
                    <div className="flex border-b border-gray-700">
                        <button 
                            onClick={() => setActiveTab('testcase')}
                            className={`px-4 py-2 text-sm font-medium ${activeTab === 'testcase' ? 'bg-gray-700 text-white' : 'text-gray-400 hover:bg-gray-700/50'}`}>
                            Testcase
                        </button>
                        <button 
                            onClick={() => setActiveTab('result')}
                            className={`px-4 py-2 text-sm font-medium ${activeTab === 'result' ? 'bg-gray-700 text-white' : 'text-gray-400 hover:bg-gray-700/50'}`}>
                            Test Result
                        </button>
                    </div>
                    <div className="p-4">
                        {activeTab === 'testcase' && (
                            <div>
                                <label className="text-xs font-semibold" htmlFor="testcase-input">Input</label>
                                <textarea id="testcase-input" className="w-full mt-1 p-2 bg-gray-900 border border-gray-600 rounded-md text-sm font-mono" rows="3" defaultValue='s = "leeetcode"'></textarea>
                            </div>
                        )}
                        {activeTab === 'result' && (
                            !result ? (
                                <div className="flex items-center justify-center h-24">
                                    <p className="text-gray-500">Run submission to see result.</p>
                                </div>
                            ) : (
                                <div>
                                    <div className="flex items-center gap-4 mb-4">
                                        {getStatusPill(result.status)}
                                    </div>
                                    {result.status !== 'PENDING' && result.status !== 'Running' && result.result && (
                                        <div className="space-y-2 text-sm">
                                            <p><strong>Runtime:</strong> <span className="font-mono">{result.result.runtime_ms} ms</span></p>
                                            <p><strong>Memory:</strong> <span className="font-mono">{result.result.memory_kb} KB</span></p>
                                        </div>
                                    )}
                                </div>
                            )
                        )}
                    </div>
                </div>
            )
        };
        
        const LeetCodeJudge = ({ user, onLogout }) => {
            const [problems, setProblems] = useState(mockProblems);
            const [currentProblem, setCurrentProblem] = useState(problems.find(p => p.id === 1)); // Start with Two Sum
            const [language, setLanguage] = useState('python');
            const [code, setCode] = useState(currentProblem.boilerplate.python);
            const [submissionResult, setSubmissionResult] = useState(null);
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isProblemListVisible, setIsProblemListVisible] = useState(false);
            const pollingIntervalRef = useRef(null);

            useEffect(() => {
                setCode(currentProblem.boilerplate[language]);
                setSubmissionResult(null); 
            }, [currentProblem, language]);

            const handleLanguageChange = (e) => {
                const newLang = e.target.value;
                setLanguage(newLang);
            };
            
            const handleCodeChange = (newCode) => setCode(newCode);
            
            const handleSelectProblem = (problem) => {
                setCurrentProblem(problem);
                setIsProblemListVisible(false);
            };

            const pollForResult = (submissionId) => {
                pollingIntervalRef.current = setInterval(async () => {
                    try {
                        const res = await fetch(`${API_BASE_URL}/api/v1/submissions/${submissionId}`);
                        const data = await res.json();
                        setSubmissionResult(data);
                        if (data.status !== 'PENDING' && data.status !== 'Running') {
                            clearInterval(pollingIntervalRef.current);
                            setIsSubmitting(false);
                        }
                    } catch (error) {
                        console.error("Polling error:", error);
                        clearInterval(pollingIntervalRef.current);
                        setIsSubmitting(false);
                    }
                }, 2000);
            };

            const handleSubmit = async () => {
                if (isSubmitting) return;
                setIsSubmitting(true);
                setSubmissionResult({ status: 'PENDING' });

                if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);

                try {
                    const response = await fetch(`${API_BASE_URL}/api/v1/submissions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: user.uid,
                            problem_id: currentProblem.id,
                            code: code,
                            language: language,
                        }),
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    setSubmissionResult(data);
                    pollForResult(data.submission_id);
                } catch (error) {
                    console.error("Submission failed:", error);
                    setSubmissionResult({ status: 'Submission Error' });
                    setIsSubmitting(false);
                }
            };
            
            useEffect(() => {
                return () => {
                    if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);
                };
            }, []);

            return (
                <div className="flex flex-col h-screen font-sans bg-gray-900 text-gray-200">
                    {isProblemListVisible && (
                        <ProblemListModal 
                            problems={problems} 
                            onSelectProblem={handleSelectProblem} 
                            onClose={() => setIsProblemListVisible(false)} 
                        />
                    )}
                    <header className="flex-shrink-0 bg-gray-800 shadow-md z-10">
                        <div className="h-14 flex items-center justify-between px-4">
                            <div className="flex-1 flex justify-start">
                                <button onClick={() => setIsProblemListVisible(true)} className="flex items-center gap-2 text-sm bg-gray-700 hover:bg-gray-600 text-white font-semibold py-1.5 px-3 rounded-md transition">
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    Problems
                                </button>
                            </div>
                            <div className="flex-1 flex justify-center">
                                <button onClick={handleSubmit} disabled={isSubmitting} className="px-6 py-1.5 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 disabled:bg-gray-500 transition">
                                    {isSubmitting ? 'Submitting...' : 'Submit'}
                                </button>
                            </div>
                            <div className="flex-1 flex justify-end">
                                <div className="relative">
                                    <img src={user.photoURL || 'https://placehold.co/32x32/666/fff?text=U'} alt="User" className="w-8 h-8 rounded-full cursor-pointer" onClick={onLogout} />
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    <main className="flex-grow flex flex-col md:flex-row overflow-hidden p-2 gap-2">
                        <div className="w-full md:w-1/2 h-full flex flex-col bg-gray-800 rounded-lg overflow-hidden">
                           <ProblemDescription problem={currentProblem} />
                        </div>
                        <div className="w-full md:w-1/2 h-full flex flex-col rounded-lg overflow-hidden">
                            <div className="flex-shrink-0 flex items-center justify-between bg-gray-800 px-4 py-2 rounded-t-lg">
                                <select value={language} onChange={handleLanguageChange} className="px-3 py-1 border border-gray-600 rounded-md bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="python">Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="java">Java</option>
                                    <option value="cpp">C++</option>
                                </select>
                            </div>
                            <div className="flex-grow relative" style={{minHeight: '200px'}}>
                               <CodeEditor language={language} boilerplate={code} onCodeChange={handleCodeChange} />
                            </div>
                            <div className="flex-shrink-0">
                                 <ResultPanel result={submissionResult} />
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const LandingPage = ({ onLoginClick }) => {
            return (
                <div className="h-screen bg-gray-900 text-white flex flex-col items-center justify-center p-4">
                    <h1 className="text-5xl font-bold mb-4">Welcome to LeetCode Judge</h1>
                    <p className="text-xl text-gray-400 mb-8">Hone your skills. Prepare for interviews. Get hired.</p>
                    <div className="flex gap-4">
                        <button onClick={onLoginClick} className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition">
                            Login
                        </button>
                        <button onClick={onLoginClick} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition">
                            Sign Up
                        </button>
                    </div>
                </div>
            );
        };

        const LoginPage = ({ onGoogleLogin, onGithubLogin, onBack }) => {
            return (
                 <div className="h-screen bg-gray-900 text-white flex flex-col items-center justify-center p-4">
                    <div className="w-full max-w-sm p-8 bg-gray-800 rounded-lg shadow-lg">
                        <button onClick={onBack} className="text-gray-400 hover:text-white mb-6">&larr; Back</button>
                        <h2 className="text-3xl font-bold text-center mb-8">Login</h2>
                        <div className="space-y-4">
                             <button onClick={onGoogleLogin} className="w-full flex items-center justify-center gap-3 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition">
                                <svg className="w-6 h-6" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.99,36.59,44,31.016,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                                Sign in with Google
                            </button>
                            <button onClick={onGithubLogin} className="w-full flex items-center justify-center gap-3 bg-gray-900 hover:bg-black text-white font-bold py-3 px-4 rounded-lg transition">
                                <svg className="w-6 h-6" viewBox="0 0 16 16" fill="currentColor"><path fillRule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
                                Sign in with GitHub
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('landing'); // 'landing', 'login', 'app'
            const [authError, setAuthError] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(user => {
                    if (user) {
                        setUser(user);
                        setView('app');
                    } else {
                        setUser(null);
                        setView('landing');
                    }
                });
                return () => unsubscribe();
            }, []);

            const handleGoogleLogin = async () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                    setAuthError(null);
                } catch (error) {
                    console.error("Google login error:", error);
                    setAuthError(error.message);
                }
            };
            
            const handleGithubLogin = async () => {
                const provider = new firebase.auth.GithubAuthProvider();
                try {
                    await auth.signInWithPopup(provider);
                    setAuthError(null);
                } catch (error) {
                    console.error("GitHub login error:", error);
                    setAuthError(error.message);
                }
            };

            const handleLogout = async () => {
                try {
                    await auth.signOut();
                } catch (error) {
                    console.error("Logout error:", error);
                }
            };

            switch (view) {
                case 'login':
                    return <LoginPage onGoogleLogin={handleGoogleLogin} onGithubLogin={handleGithubLogin} onBack={() => setView('landing')} />;
                case 'app':
                    return <LeetCodeJudge user={user} onLogout={handleLogout} />;
                case 'landing':
                default:
                    return <LandingPage onLoginClick={() => setView('login')} />;
            }
        };

        // --- Mount the App ---
        const container = document.getElementById('root');
        ReactDOM.createRoot(container).render(<App />);
    </script>
</body>
</html>
